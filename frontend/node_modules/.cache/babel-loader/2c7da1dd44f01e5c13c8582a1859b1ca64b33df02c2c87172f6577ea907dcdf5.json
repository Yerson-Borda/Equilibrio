{"ast":null,"code":"// src/services/api.js\nconst API_BASE_URL = '/api/v1';\nclass ApiService {\n  constructor() {\n    this.token = localStorage.getItem('token');\n  }\n  setToken(token) {\n    this.token = token;\n    localStorage.setItem('token', token);\n  }\n  removeToken() {\n    this.token = null;\n    localStorage.removeItem('token');\n  }\n  getAuthHeaders() {\n    const headers = {\n      'Content-Type': 'application/json'\n    };\n    if (this.token) {\n      headers['Authorization'] = `Bearer ${this.token}`;\n    }\n    return headers;\n  }\n  async handleResponse(response) {\n    console.log('=== RESPONSE DEBUG INFO ===');\n    console.log('URL:', response.url);\n    console.log('Status:', response.status);\n    console.log('Status Text:', response.statusText);\n    console.log('Headers:', Object.fromEntries(response.headers.entries()));\n    const text = await response.text();\n    console.log('Raw response text:', text);\n    console.log('=== END DEBUG INFO ===');\n\n    // Try to parse as JSON, but handle cases where it's not JSON\n    let data;\n    if (text) {\n      try {\n        data = JSON.parse(text);\n      } catch (e) {\n        console.error('JSON parse error. Response is not valid JSON:', e);\n        // If it's HTML, it might be an error page\n        if (text.includes('<!DOCTYPE html>') || text.includes('<html>')) {\n          throw {\n            status: response.status,\n            message: 'Server returned HTML instead of JSON. The endpoint might be incorrect.',\n            errors: 'Check if the API endpoint exists'\n          };\n        } else {\n          throw {\n            status: response.status,\n            message: 'Server returned invalid JSON response',\n            errors: text.substring(0, 200) // First 200 chars of response\n          };\n        }\n      }\n    } else {\n      data = {};\n    }\n    if (!response.ok) {\n      var _data, _data2;\n      throw {\n        status: response.status,\n        message: ((_data = data) === null || _data === void 0 ? void 0 : _data.detail) || `HTTP Error: ${response.status} ${response.statusText}`,\n        errors: ((_data2 = data) === null || _data2 === void 0 ? void 0 : _data2.detail) || data || text\n      };\n    }\n    return data;\n  }\n\n  // Auth endpoints - Let's test the exact endpoint structure\n  async login(email, password) {\n    console.log('=== LOGIN REQUEST ===');\n\n    // Test different endpoint formats\n    const endpoints = ['/api/v1/users/login', '/api/v1/users/login/', '/users/login', '/users/login/'];\n\n    // Try the most likely endpoint first\n    const endpoint = '/api/v1/users/login';\n    console.log('Trying endpoint:', endpoint);\n    const params = new URLSearchParams();\n    params.append('email', email);\n    params.append('password', password);\n    const response = await fetch(`${endpoint}?${params}`, {\n      method: 'POST',\n      headers: this.getAuthHeaders()\n    }).catch(error => {\n      console.error('Network error:', error);\n      throw {\n        status: 0,\n        message: 'Network error: Failed to connect to server',\n        errors: error.message\n      };\n    });\n    return this.handleResponse(response);\n  }\n  async register(fullName, email, password) {\n    console.log('=== REGISTER REQUEST ===');\n\n    // Test different endpoint formats\n    const endpoints = ['/api/v1/users/register', '/api/v1/users/register/', '/users/register', '/users/register/'];\n\n    // Try the most likely endpoint first\n    const endpoint = '/api/v1/users/register';\n    console.log('Trying endpoint:', endpoint);\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: this.getAuthHeaders(),\n      body: JSON.stringify({\n        full_name: fullName,\n        email: email,\n        password: password,\n        default_currency: 'USD'\n      })\n    }).catch(error => {\n      console.error('Network error:', error);\n      throw {\n        status: 0,\n        message: 'Network error: Failed to connect to server',\n        errors: error.message\n      };\n    });\n    return this.handleResponse(response);\n  }\n  async getCurrentUser() {\n    const response = await fetch('/api/v1/users/me', {\n      method: 'GET',\n      headers: this.getAuthHeaders()\n    }).catch(error => {\n      console.error('Network error:', error);\n      throw {\n        status: 0,\n        message: 'Network error: Failed to connect to server',\n        errors: error.message\n      };\n    });\n    return this.handleResponse(response);\n  }\n\n  // Test if we can reach the backend at all\n  async testBackend() {\n    const testUrls = ['/health', '/', '/docs', '/api/v1/users/register', '/api/v1/users/login'];\n    console.log('=== TESTING BACKEND CONNECTIONS ===');\n    for (const url of testUrls) {\n      try {\n        console.log(`Testing: ${url}`);\n        const response = await fetch(url, {\n          method: 'GET'\n        });\n        console.log(`✅ ${url}: ${response.status} ${response.statusText}`);\n        console.log('Content-Type:', response.headers.get('content-type'));\n        const text = await response.text();\n        console.log('Response sample:', text.substring(0, 100));\n        console.log('---');\n        if (response.ok) {\n          return {\n            connected: true,\n            workingUrl: url\n          };\n        }\n      } catch (error) {\n        console.log(`❌ ${url}: ${error.message}`);\n      }\n    }\n    return {\n      connected: false,\n      workingUrl: null\n    };\n  }\n  isAuthenticated() {\n    return !!this.token;\n  }\n}\nexport const apiService = new ApiService();","map":{"version":3,"names":["API_BASE_URL","ApiService","constructor","token","localStorage","getItem","setToken","setItem","removeToken","removeItem","getAuthHeaders","headers","handleResponse","response","console","log","url","status","statusText","Object","fromEntries","entries","text","data","JSON","parse","e","error","includes","message","errors","substring","ok","_data","_data2","detail","login","email","password","endpoints","endpoint","params","URLSearchParams","append","fetch","method","catch","register","fullName","body","stringify","full_name","default_currency","getCurrentUser","testBackend","testUrls","get","connected","workingUrl","isAuthenticated","apiService"],"sources":["C:/Users/aswad/Downloads/Development project/Frontend/frontend/src/services/api.jsx"],"sourcesContent":["// src/services/api.js\r\nconst API_BASE_URL = '/api/v1';\r\n\r\nclass ApiService {\r\n    constructor() {\r\n        this.token = localStorage.getItem('token');\r\n    }\r\n\r\n    setToken(token) {\r\n        this.token = token;\r\n        localStorage.setItem('token', token);\r\n    }\r\n\r\n    removeToken() {\r\n        this.token = null;\r\n        localStorage.removeItem('token');\r\n    }\r\n\r\n    getAuthHeaders() {\r\n        const headers = {\r\n            'Content-Type': 'application/json',\r\n        };\r\n\r\n        if (this.token) {\r\n            headers['Authorization'] = `Bearer ${this.token}`;\r\n        }\r\n\r\n        return headers;\r\n    }\r\n\r\n    async handleResponse(response) {\r\n        console.log('=== RESPONSE DEBUG INFO ===');\r\n        console.log('URL:', response.url);\r\n        console.log('Status:', response.status);\r\n        console.log('Status Text:', response.statusText);\r\n        console.log('Headers:', Object.fromEntries(response.headers.entries()));\r\n\r\n        const text = await response.text();\r\n        console.log('Raw response text:', text);\r\n        console.log('=== END DEBUG INFO ===');\r\n\r\n        // Try to parse as JSON, but handle cases where it's not JSON\r\n        let data;\r\n        if (text) {\r\n            try {\r\n                data = JSON.parse(text);\r\n            } catch (e) {\r\n                console.error('JSON parse error. Response is not valid JSON:', e);\r\n                // If it's HTML, it might be an error page\r\n                if (text.includes('<!DOCTYPE html>') || text.includes('<html>')) {\r\n                    throw {\r\n                        status: response.status,\r\n                        message: 'Server returned HTML instead of JSON. The endpoint might be incorrect.',\r\n                        errors: 'Check if the API endpoint exists'\r\n                    };\r\n                } else {\r\n                    throw {\r\n                        status: response.status,\r\n                        message: 'Server returned invalid JSON response',\r\n                        errors: text.substring(0, 200) // First 200 chars of response\r\n                    };\r\n                }\r\n            }\r\n        } else {\r\n            data = {};\r\n        }\r\n\r\n        if (!response.ok) {\r\n            throw {\r\n                status: response.status,\r\n                message: data?.detail || `HTTP Error: ${response.status} ${response.statusText}`,\r\n                errors: data?.detail || data || text,\r\n            };\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    // Auth endpoints - Let's test the exact endpoint structure\r\n    async login(email, password) {\r\n        console.log('=== LOGIN REQUEST ===');\r\n\r\n        // Test different endpoint formats\r\n        const endpoints = [\r\n            '/api/v1/users/login',\r\n            '/api/v1/users/login/',\r\n            '/users/login',\r\n            '/users/login/'\r\n        ];\r\n\r\n        // Try the most likely endpoint first\r\n        const endpoint = '/api/v1/users/login';\r\n        console.log('Trying endpoint:', endpoint);\r\n\r\n        const params = new URLSearchParams();\r\n        params.append('email', email);\r\n        params.append('password', password);\r\n\r\n        const response = await fetch(`${endpoint}?${params}`, {\r\n            method: 'POST',\r\n            headers: this.getAuthHeaders(),\r\n        }).catch(error => {\r\n            console.error('Network error:', error);\r\n            throw {\r\n                status: 0,\r\n                message: 'Network error: Failed to connect to server',\r\n                errors: error.message\r\n            };\r\n        });\r\n\r\n        return this.handleResponse(response);\r\n    }\r\n\r\n    async register(fullName, email, password) {\r\n        console.log('=== REGISTER REQUEST ===');\r\n\r\n        // Test different endpoint formats\r\n        const endpoints = [\r\n            '/api/v1/users/register',\r\n            '/api/v1/users/register/',\r\n            '/users/register',\r\n            '/users/register/'\r\n        ];\r\n\r\n        // Try the most likely endpoint first\r\n        const endpoint = '/api/v1/users/register';\r\n        console.log('Trying endpoint:', endpoint);\r\n\r\n        const response = await fetch(endpoint, {\r\n            method: 'POST',\r\n            headers: this.getAuthHeaders(),\r\n            body: JSON.stringify({\r\n                full_name: fullName,\r\n                email: email,\r\n                password: password,\r\n                default_currency: 'USD'\r\n            }),\r\n        }).catch(error => {\r\n            console.error('Network error:', error);\r\n            throw {\r\n                status: 0,\r\n                message: 'Network error: Failed to connect to server',\r\n                errors: error.message\r\n            };\r\n        });\r\n\r\n        return this.handleResponse(response);\r\n    }\r\n\r\n    async getCurrentUser() {\r\n        const response = await fetch('/api/v1/users/me', {\r\n            method: 'GET',\r\n            headers: this.getAuthHeaders(),\r\n        }).catch(error => {\r\n            console.error('Network error:', error);\r\n            throw {\r\n                status: 0,\r\n                message: 'Network error: Failed to connect to server',\r\n                errors: error.message\r\n            };\r\n        });\r\n\r\n        return this.handleResponse(response);\r\n    }\r\n\r\n    // Test if we can reach the backend at all\r\n    async testBackend() {\r\n        const testUrls = [\r\n            '/health',\r\n            '/',\r\n            '/docs',\r\n            '/api/v1/users/register',\r\n            '/api/v1/users/login'\r\n        ];\r\n\r\n        console.log('=== TESTING BACKEND CONNECTIONS ===');\r\n\r\n        for (const url of testUrls) {\r\n            try {\r\n                console.log(`Testing: ${url}`);\r\n                const response = await fetch(url, {\r\n                    method: 'GET',\r\n                });\r\n                console.log(`✅ ${url}: ${response.status} ${response.statusText}`);\r\n                console.log('Content-Type:', response.headers.get('content-type'));\r\n\r\n                const text = await response.text();\r\n                console.log('Response sample:', text.substring(0, 100));\r\n                console.log('---');\r\n\r\n                if (response.ok) {\r\n                    return { connected: true, workingUrl: url };\r\n                }\r\n            } catch (error) {\r\n                console.log(`❌ ${url}: ${error.message}`);\r\n            }\r\n        }\r\n\r\n        return { connected: false, workingUrl: null };\r\n    }\r\n\r\n    isAuthenticated() {\r\n        return !!this.token;\r\n    }\r\n}\r\n\r\nexport const apiService = new ApiService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}